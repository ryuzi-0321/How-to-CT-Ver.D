{% extends 'ct_app/base.html' %}

{% block title %}ホーム - How to CT{% endblock %}

{% block header_info %}
    {% with sick_count=sicks|length form_count=forms|length protocol_count=protocols|length %}
    <div class="d-flex gap-3 justify-content-end text-white">
        <div class="text-center">
            <small class="d-block opacity-75" style="font-size: 0.7rem;">疾患データ</small>
            <span class="fs-4 fw-bold">{{ sick_count }}</span>
        </div>
        <div class="text-center">
            <small class="d-block opacity-75" style="font-size: 0.7rem;">お知らせ</small>
            <span class="fs-4 fw-bold">{{ form_count }}</span>
        </div>
        <div class="text-center">
            <small class="d-block opacity-75" style="font-size: 0.7rem;">プロトコル</small>
            <span class="fs-4 fw-bold">{{ protocol_count }}</span>
        </div>
    </div>
    {% endwith %}
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2 class="section-title">
            <i class="bi bi-house-heart"></i> ようこそ
        </h2>
        <div class="card disease-card mb-4">
            <div class="card-body p-4">
                <h5 class="card-title fw-bold">How to CTについて</h5>
                <p class="card-text fs-5">
                    このシステムは、診療放射線技師向けのCT検査マニュアルです。
                    疾患別の撮影プロトコル、造影手順、画像処理方法を検索・参照できます。
                </p>
                <div class="mt-3">
                    <a href="{% url 'sick_list' %}" class="btn btn-primary px-4">
                        <i class="bi bi-search"></i> 疾患検索を開始
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <h2 class="section-title">
            <i class="bi bi-megaphone"></i> 最新のお知らせ
        </h2>
    </div>
</div>

<div class="row row-cols-1 row-cols-md-5 g-3">
    {% if forms %}
        {% for form in forms|slice:":5" %}
            <div class="col">
                <div class="notice-item h-100 d-flex flex-column border p-2 rounded shadow-sm bg-white position-relative {% if '重要' in form.title %}is-important{% endif %}">
                    <h6 class="fw-bold text-truncate mb-1" title="{{ form.title }}">
                        {% if '重要' in form.title %}
                            <span class="text-danger"><i class="bi bi-exclamation-triangle-fill"></i></span>
                        {% endif %}
                        {{ form.title }}
                    </h6>
                    <p class="text-muted mb-1" style="font-size: 0.7rem;">{{ form.created_at|date:'Y/m/d H:i' }}</p>
                    <p class="small text-secondary text-truncate mb-2">{{ form.main }}</p>
                    
                    <div class="mt-auto">
                        <a href="{% url 'form_detail' form.pk %}" class="btn btn-sm btn-outline-primary w-100 stretched-link" style="font-size: 0.7rem;">
                            詳細を見る
                        </a>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="col-12">
            <div class="alert alert-info">お知らせがまだ投稿されていません。</div>
        </div>
    {% endif %}
</div>

{% if forms.count > 5 %}
<div class="row mt-3">
    <div class="col-12 text-end">
        <a href="{% url 'form_list' %}" class="btn btn-link text-decoration-none">
            もっと見る <i class="bi bi-chevron-right"></i>
        </a>
    </div>
</div>
{% endif %}

<div class="row mt-4">
    <div class="col-12">
        <h2 class="section-title">
            <i class="bi bi-plus-circle"></i> データ作成
        </h2>
    </div>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-plus-lg"></i> 疾患データ</h5>
                <p class="card-text">新しい疾患データを作成します</p>
                <a href="{% url 'sick_create' %}" class="btn btn-primary btn-sm">作成</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-plus-lg"></i> お知らせ</h5>
                <p class="card-text">新しいお知らせを投稿します</p>
                <a href="{% url 'form_create' %}" class="btn btn-primary btn-sm">作成</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-plus-lg"></i> プロトコル</h5>
                <p class="card-text">新しいCTプロトコルを作成します</p>
                <a href="{% url 'protocol_create' %}" class="btn btn-primary btn-sm">作成</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}